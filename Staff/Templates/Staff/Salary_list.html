{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container mt-4">

    <div class="coffee-card">

        <h2 class="coffee-title">
            <i class="fa-solid fa-money-check-dollar"></i>
            Bảng Lương Nhân Viên
        </h2>
        <p class="text-muted mb-3">Quản lý bảng lương theo tháng/năm</p>

        <!-- FILTER -->
        <form method="get" class="row g-3 mb-4">
            <div class="col-md-3">
                <label>Tháng</label>
                <select name="month" class="form-select">
                    <option value="">Tất cả</option>
                    {% for m in months %}
                        <option value="{{ m }}" {% if request.GET.month == m|stringformat:"s" %}selected{% endif %}>
                            Tháng {{ m }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <label>Năm</label>
                <input type="number" class="form-control" name="year"
                       value="{{ request.GET.year|default:2025 }}">
            </div>

            <div class="col-md-6 d-flex align-items-end">
                <button class="coffee-btn me-2" type="submit">Lọc</button>
                <a href="{% url 'calculate_salary' %}" class="coffee-btn me-2">
                    Tính Lương Tự Động
                </a>
                <a href="{% url 'salary_create' %}" class="coffee-btn">
                    Tạo Thủ Công
                </a>
            </div>
        </form>

        <!-- BẢNG LƯƠNG -->
        <table class="coffee-table">
            <thead>
                <tr>
                    <th>Nhân Viên</th>
                    <th>Tháng/Năm</th>
                    <th>Tổng Giờ</th>
                    <th>Tổng Ca</th>
                    <th>Lương Cơ Bản</th>
                    <th>Thưởng/Khấu Trừ</th>
                    <th>Tổng Lương</th>
                    <th>Trạng Thái</th>
                    <th>Thao Tác</th>
                </tr>
            </thead>
            <tbody>
                {% for salary in salaries %}
                <tr>
                    <td>
                        <strong>{{ salary.employee.get_full_name }}</strong><br>
                        <small class="text-muted">{{ salary.employee.username }}</small>
                    </td>
                    <td>{{ salary.month }}/{{ salary.year }}</td>
                    <td>{{ salary.total_hours }}h</td>
                    <td>{{ salary.total_shifts }}</td>
                    <td>{{ salary.base_salary|floatformat:0 }} ₫</td>
                    <td>
                        +{{ salary.bonus|floatformat:0 }} /
                        -{{ salary.deduction|floatformat:0 }}
                    </td>
                    <td><strong>{{ salary.total_salary|floatformat:0 }} ₫</strong></td>
                    <td>{{ salary.get_status_display }}</td>
                    <td>
                        <a href="{% url 'salary_detail' salary.pk %}" class="coffee-action-btn">Chi tiết</a>
                        <a href="{% url 'salary_update' salary.pk %}" class="coffee-action-btn">Sửa</a>
                        {% if salary.status != 'paid' %}
                        <a href="{% url 'make_payment' salary.pk %}" class="coffee-action-btn">Trả</a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="9" class="empty-state">
                        <i class="fas fa-file-invoice-dollar fa-3x mb-3" style="color:#e3ab77;"></i><br>
                        Chưa có bảng lương nào.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

</div>
{% endblock %}
